<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.587">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Understanding ML Metrics with the RandomForestClassifier</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="comma_files/libs/clipboard/clipboard.min.js"></script>
<script src="comma_files/libs/quarto-html/quarto.js"></script>
<script src="comma_files/libs/quarto-html/popper.min.js"></script>
<script src="comma_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="comma_files/libs/quarto-html/anchor.min.js"></script>
<link href="comma_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="comma_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="comma_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="comma_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="comma_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Understanding ML Metrics with the RandomForestClassifier</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="fit-a-classification-model" class="level1">
<h1>Fit a Classification Model</h1>
<p>Classification models are very useful in data science. In certain limited capacities, we can use them to speed up and sometimes automate decision making. Many fraud prevention companies use classification models to predict if fraud has occurred. The following model will look at punctuation thoughts and opinion data from a 538 Survey to predict gender.</p>
<p><em>Note: the following model by design is not very good. This is understandable since the data is how one uses punctuation. This is merely for explanations.</em></p>
<p><strong>Step 1: Import Libraries</strong></p>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTS</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><strong>Step 2: Read in Data</strong></p>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># READ IN DATA</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>raw_comma <span class="op">=</span> pd.read_csv(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'https://raw.githubusercontent.com/fivethirtyeight/data/master/comma-survey/comma-survey.csv'</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    skiprows<span class="op">=</span><span class="dv">1</span>, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    header<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>raw_comma.head(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>10</th>
      <th>11</th>
      <th>12</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3292953864</td>
      <td>It's important for a person to be honest, kind...</td>
      <td>Yes</td>
      <td>Some</td>
      <td>Some experts say it's important to drink milk,...</td>
      <td>No</td>
      <td>Not much</td>
      <td>Somewhat important</td>
      <td>Male</td>
      <td>30-44</td>
      <td>$50,000 - $99,999</td>
      <td>Bachelor degree</td>
      <td>South Atlantic</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p><strong>Step 3: Wrangle Data</strong></p>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SELECT AND RENAME COLUMNS</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>comma <span class="op">=</span> (raw_comma</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    .dropna(subset <span class="op">=</span> [<span class="dv">8</span>])</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    .drop([<span class="dv">0</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    .rename(columns <span class="op">=</span> {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>:<span class="st">'write_comma'</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>:<span class="st">'heard_comma'</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>:<span class="st">'care_comma'</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="dv">4</span>:<span class="st">'write_data'</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="dv">5</span>:<span class="st">'heard_data'</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="dv">6</span>:<span class="st">'care_data'</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="dv">7</span>:<span class="st">'care_grammar'</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="dv">8</span>:<span class="st">'gender'</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        }))</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># RECODE VALUES FOR MODELING</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> yn_recode(<span class="bu">input</span>):</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">input</span> <span class="op">==</span> <span class="st">"Yes"</span>: <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">input</span> <span class="op">==</span> <span class="st">"No"</span>: <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: <span class="cf">return</span> np.nan</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scale_recode(<span class="bu">input</span>):</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">input</span> <span class="op">==</span> <span class="st">"A lot"</span> <span class="kw">or</span> <span class="bu">input</span> <span class="op">==</span> <span class="st">"Very important"</span> : <span class="cf">return</span> <span class="dv">2</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">input</span> <span class="op">==</span> <span class="st">"Some"</span> <span class="kw">or</span> <span class="bu">input</span> <span class="op">==</span> <span class="st">"Somewhat important"</span>: <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">input</span> <span class="op">==</span> <span class="st">"Not much"</span> <span class="kw">or</span> <span class="bu">input</span> <span class="op">==</span> <span class="st">"Somewhat unimportant"</span>: <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">input</span> <span class="op">==</span> <span class="st">"Not at all"</span> <span class="kw">or</span> <span class="bu">input</span> <span class="op">==</span> <span class="st">"Very unimportant"</span>: <span class="cf">return</span> <span class="op">-</span><span class="dv">2</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: <span class="cf">return</span> np.nan</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> write_comma_recode(<span class="bu">input</span>):</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">input</span> <span class="op">==</span> <span class="st">"It's important for a person to be honest, kind, and loyal."</span>: <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">input</span> <span class="op">==</span> <span class="st">"It's important for a person to be honest, kind and loyal."</span>: <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: <span class="cf">return</span> np.nan</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> write_data_recode(<span class="bu">input</span>):</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">input</span> <span class="op">==</span> <span class="st">"Some experts say it's important to drink milk, but the data are inconclusive."</span>: <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">input</span> <span class="op">==</span> <span class="st">"Some experts say it's important to drink milk, but the data is inconclusive."</span>: <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: <span class="cf">return</span> np.nan</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> [<span class="st">'care_comma'</span>,<span class="st">'care_data'</span>,<span class="st">'care_grammar'</span>]:</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    comma[i] <span class="op">=</span> comma[i].<span class="bu">apply</span>(scale_recode)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> [<span class="st">'heard_comma'</span>,<span class="st">'heard_data'</span>]:</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    comma[i] <span class="op">=</span> comma[i].<span class="bu">apply</span>(yn_recode)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>comma[<span class="st">"write_comma"</span>] <span class="op">=</span> comma[<span class="st">"write_comma"</span>].<span class="bu">apply</span>(write_comma_recode)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>comma[<span class="st">"write_data"</span>] <span class="op">=</span> comma[<span class="st">"write_data"</span>].<span class="bu">apply</span>(write_data_recode)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="co"># REMOVE NA'S</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>ml_comma <span class="op">=</span> comma.dropna().reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><strong>Step 4: Model Data</strong></p>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SET FILTERED VARIABLES </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>X_pred <span class="op">=</span> ml_comma.drop(columns <span class="op">=</span> [<span class="st">'gender'</span>])</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> ml_comma[<span class="st">'gender'</span>] <span class="op">==</span> <span class="st">'Male'</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># SPLIT VARIABLES</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X_pred,y_pred,test_size<span class="op">=</span><span class="fl">.2</span>,random_state <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE FITTED MODEL WITH TRAINING DATA</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">1</span>).fit(X_train, y_train)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TEST</span><span class="co"> MODEL AND REPORT ACCURACY</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> clf.predict(X_test)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>y_probs <span class="op">=</span> clf.predict_proba(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><strong>Step 5: Model Metrics</strong></p>
<div id="feature-importance-chart." class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GIVE FEATURE IMPORTANCE</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>feature_raw <span class="op">=</span> pd.DataFrame(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'features'</span>: X_train.columns, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'importance'</span>: clf.feature_importances_})</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>feature_df <span class="op">=</span> (feature_raw</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    .sort_values([<span class="st">'importance'</span>], ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">12</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#MAKE PLOT FOR MOST IMPORTANT FEATURES</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>f, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">"importance"</span>, y<span class="op">=</span><span class="st">"features"</span>, data<span class="op">=</span>feature_df, color <span class="op">=</span> <span class="st">'darkblue'</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Importance'</span>, fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Feature Type'</span>, fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Features by Importance'</span>, fontsize <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metrics.confusion_matrix(y_test, y_pred))</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>matrixpng_raw <span class="op">=</span> metrics.plot_confusion_matrix(clf, X_test, y_test)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="comma_files/figure-html/feature-importance-chart.-output-1.png" id="feature-importance-chart.-1" width="565" height="567"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[69 40]
 [43 50]]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Aj\AppData\Local\Programs\Python\Python310\lib\site-packages\sklearn\utils\deprecation.py:87: FutureWarning: Function plot_confusion_matrix is deprecated; Function `plot_confusion_matrix` is deprecated in 1.0 and will be removed in 1.2. Use one of the class methods: ConfusionMatrixDisplay.from_predictions or ConfusionMatrixDisplay.from_estimator.
  warnings.warn(msg, category=FutureWarning)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="comma_files/figure-html/feature-importance-chart.-output-4.png" id="feature-importance-chart.-2" width="508" height="462"></p>
</div>
</div>
</section>
<section id="describe-classification-models" class="level1">
<h1>Describe Classification Models</h1>
<section id="confusion-matrix-array" class="level2">
<h2 class="anchored" data-anchor-id="confusion-matrix-array">Confusion matrix array</h2>
<p>The confusion matrix shows all the combinations of the following:</p>
<ul>
<li>The prediction on a row of data</li>
<li>The actual state of the row of data</li>
</ul>
<p>There are four types of general labels from the confusion matrix:</p>
<ul>
<li><p>If the prediction is TRUE, and the classification is correct, then this is a <strong>TRUE POSITIVE</strong>.</p></li>
<li><p>If the prediction is TRUE, and the classification is not correct, then this is a <strong>FALSE POSITIVE</strong>.</p></li>
<li><p>If the prediction is FALSE, and the classification is correct, then this is a <strong>TRUE NEGATIVE</strong>.</p></li>
<li><p>If the prediction is FALSE, and the classification is not correct, then this is a <strong>FALSE NEGATIVE</strong>.</p></li>
</ul>
<p>The following array describes the confusion matrix values. The left and right columns describe whether or not the classification has been predicted TRUE or FALSE. The top and bottom rows describe the actual or true state of the data.</p>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>metrics.confusion_matrix(y_test, y_pred)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># queries first row, then column</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>TN <span class="op">=</span> metrics.confusion_matrix(y_test, y_pred)[<span class="dv">0</span>][<span class="dv">0</span>] </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>FP <span class="op">=</span> metrics.confusion_matrix(y_test, y_pred)[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>FN <span class="op">=</span> metrics.confusion_matrix(y_test, y_pred)[<span class="dv">1</span>][<span class="dv">0</span>]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>TP <span class="op">=</span> metrics.confusion_matrix(y_test, y_pred)[<span class="dv">1</span>][<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="accuracy-sensitivity-and-specificity" class="level2">
<h2 class="anchored" data-anchor-id="accuracy-sensitivity-and-specificity">Accuracy, Sensitivity, and Specificity</h2>
<p><strong>Accuracy</strong> describes <em>how many correct predictions</em> / <em>how many total predictions</em>. If the dataset is pretty even, this can be a very useful metric. This, however, may not be the case with all datasets. For example, if 95 percent of all data rows should be predicted negative, a model that <em>only</em> spits out negatives will be 95 percent accurate.</p>
<p>There’s a joke in machine learning: The professor says that he developed a model that predicts whether or not someone is a terrorist with over 99 percent accuracy. The students are perplexed and ask the professor to show them the model. The professor shows the following model: <em>f(x) = 0</em>. Since over 99 percent of people are NOT terrorists, just saying FALSE will be accurate over 99 percent of the time.</p>
<p>If we actually wanted to see how good this model is at identifying terrorists, we will need a different metric:</p>
<p><strong>Sensitivity</strong> is like accuracy, but just for data that should be classified as positive. Sensitivity is calculated by <em>correctly predicted positives</em> / <em>all actual positives</em>. In the terrorist example, the numerator is how many terrorists were correctly identified, and the denominator is the total amount of terrorists. The sensitivity for the terrorist example would be zero percent because out of all terrorists, none of them were correctly identified.</p>
<p><strong>Specificity</strong> is like accuracy, but just for data that should be classified as negative. Specificity is calculated by <em>correctly predicted negatives</em> / <em>all actual negatives</em>. In the terrorist example, the numerator is how many non-terrorists were correctly identified, and the denominator is the total amount of non-terrorists. The specificity for the terrorist example would be 100 percent since all non-terrorists were predicted to be non-terrorists.</p>
<p><strong>Accuracy for the Model</strong> The following code will calculate the accuracy for the model. The accuracy for the model is calculated by <em>correctly predicted rows</em> / <em>all rows</em>. More concretely, this is calculated by (<em>correctly predicted males</em> + <em>correctly predicted females</em>) / (<em>all males and females</em>)</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> (TN <span class="op">+</span> TP) <span class="op">/</span> (TN <span class="op">+</span> TP <span class="op">+</span> FN <span class="op">+</span> FP)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Accuracy = "</span>,(<span class="bu">round</span>(accuracy,<span class="dv">2</span>)<span class="op">*</span><span class="dv">100</span>),<span class="st">"%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy =  59.0 %</code></pre>
</div>
</div>
<p><strong>Sensitivity and Specificity for the Model</strong> The following code will calculate the sensitivity and specificity for the model. The sensitivity is calculated by <em>males predicted correctly</em> / <em>all males</em>. The specificity is calculated by <em>females predicted correctly</em> / <em>all females</em>. The reason why male is sensitivity and female is specificity is that in the code, male is coded in such a way that males are 1 (TRUE) and non-males (females) are 0 (FALSE). This is just for math.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="op">=</span> (TP) <span class="op">/</span> (TP <span class="op">+</span> FN)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>specificity <span class="op">=</span> (TN) <span class="op">/</span> (TN <span class="op">+</span> FP)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sensitivity = "</span>,(<span class="bu">round</span>(sensitivity,<span class="dv">2</span>)<span class="op">*</span><span class="dv">100</span>),<span class="st">"%"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Specificity = "</span>,(<span class="bu">round</span>(specificity,<span class="dv">2</span>)<span class="op">*</span><span class="dv">100</span>),<span class="st">"%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sensitivity =  54.0 %
Specificity =  63.0 %</code></pre>
</div>
</div>
<p>Since specificity is higher, this means that the accuracy for females is higher than males.</p>
</section>
<section id="the-roc-curve" class="level2">
<h2 class="anchored" data-anchor-id="the-roc-curve">The ROC Curve</h2>
<p>The unseen function produced by fitting the model will output some number to determine if we should classify the row as a male or female. Since Males are TRUE/1 and Females are FALSE/0, a number is output between 0 and 1 to predict the gender of the row of data. For example, if the outputed number is .9, the gender of the row is probably male. Conversely, if the outputed number is .1, the gender of the row is probably female.</p>
<p>The threshold here is .5- meaning that if the output is greater than the threshold, we classify the row as a male, but if the output is less than the threshold, we classify the row as a female.</p>
<p>If we were to increase the threshold to .6, this means that we are more likely to correctly predict females- BUT we are more likely to incorrectly guess males- since males will now have a more demanding threshold to reach. This will increase Specificity since females are assigned FALSE/0.</p>
<p>The <strong>ROC curve</strong> is used to visually see what happens when we set the threshold for prediction to prioritize sensitivity or specificity.</p>
<p>On the following graph, we will see two measurements: <em>True Positve Rate</em> and <em>False Positve Rate</em>.</p>
<ul>
<li>True Positve Rate measures sensitivity</li>
<li>False Positve Rate measures (1 - specificity)</li>
</ul>
<div class="cell" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>metrics.plot_roc_curve(clf,X_test,y_test)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Aj\AppData\Local\Programs\Python\Python310\lib\site-packages\sklearn\utils\deprecation.py:87: FutureWarning: Function plot_roc_curve is deprecated; Function :func:`plot_roc_curve` is deprecated in 1.0 and will be removed in 1.2. Use one of the class methods: :meth:`sklearn.metric.RocCurveDisplay.from_predictions` or :meth:`sklearn.metric.RocCurveDisplay.from_estimator`.
  warnings.warn(msg, category=FutureWarning)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="comma_files/figure-html/cell-10-output-2.png" width="514" height="495"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>